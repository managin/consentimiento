<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consentimiento Informado</title>
    <!-- Incluimos Tailwind CSS para un diseño limpio y responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Incluimos una fuente moderna para mejorar la legibilidad -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        /* ------------------------------------------------------------------- */
        /* Estilos para la CASILLA DE VERIFICACIÓN (PANTALLA) */
        /* ------------------------------------------------------------------- */
        .custom-checkbox {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid #6b7280; 
            background-color: #fff;
            border-radius: 0.3rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            user-select: none;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .custom-checkbox.checked {
            border-color: #3b82f6;
            background-color: #3b82f6;
        }

        .custom-checkbox .checkmark {
            color: #fff;
            font-weight: bold;
            font-size: 1.2rem;
            display: none;
            line-height: 1;
        }

        .custom-checkbox.checked .checkmark {
            display: block;
        }
        
        /* ------------------------------------------------------------------- */
        /* SOLUCIÓN PUNTO 2: Estilos solo para el PDF (PRINT) */
        /* ------------------------------------------------------------------- */
        @media print {
            .custom-checkbox {
                width: 25px; 
                height: 25px;
                border: 3px solid #1f2937 !important;
                border-radius: 4px;
                background-color: white !important;
            }

            .custom-checkbox.checked {
                background-color: white !important; 
                border-color: #1f2937 !important;
            }
            
            .custom-checkbox.checked .checkmark {
                display: block !important;
                color: #1f2937 !important;
                font-size: 20px;
                font-weight: 900;
                content: "\2713"; 
            }

            input:disabled {
                background-color: transparent !important;
                border-color: transparent !important;
                box-shadow: none !important;
                padding-left: 0 !important;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- Contenedor principal del formulario -->
    <div id="form-container" class="max-w-3xl mx-auto bg-white rounded-xl shadow-lg p-6 sm:p-8 lg:p-10 border border-gray-200">

        <!-- Título y descripción -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">CONSENTIMIENTO INFORMADO</h1>
            <div class="mt-6 border-b-2 border-gray-300 pb-2">
                <p class="text-gray-700 font-medium">Lucía Pizzorno</p>
                <p class="text-gray-600 text-sm">Profesional en Medicina Ayurveda (Vaidya B.A.M.S., Acharya - India)</p>
            </div>
            <p class="mt-6 text-gray-600 leading-relaxed text-justify">
                El Consentimiento Informado es la declaración libre y voluntaria efectuada por el consultante, emitida luego de recibir información clara, precisa y adecuada inherente a su consulta, y a los procedimientos o pautas propuestas, con respecto a objetivos y beneficios de Ayurveda. Su firma en el presente documento es la constancia de que comprendió todo lo explicado y presta conformidad a iniciar con el acompañamiento propuesto.
            </p>
        </header>

        <!-- Formulario en sí -->
        <form id="consentimientoForm" class="space-y-8">

            <!-- Sección 1: Datos personales -->
            <section class="border-b pb-8 border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Datos del Consultante</h2>
                <div class="space-y-4">
                    <!-- Campo Nombre y apellido -->
                    <div>
                        <label for="nombre" class="block text-sm font-medium text-gray-700">Nombre y apellido del consultante</label>
                        <input type="text" id="nombre" name="nombre" required
                                class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    </div>
                    <!-- Campo DNI -->
                    <div>
                        <label for="dni" class="block text-sm font-medium text-gray-700">DNI</label>
                        <input type="text" id="dni" name="dni" required
                                class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    </div>
                    <!-- Campo Lugar -->
                    <div>
                        <label for="lugar" class="block text-sm font-medium text-gray-700">Lugar</label>
                        <input type="text" id="lugar" name="lugar" required
                                class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    </div>
                    <!-- Campo Fecha -->
                    <div>
                        <label for="fecha" class="block text-sm font-medium text-gray-700">Fecha</label>
                        <input type="date" id="fecha" name="fecha" required
                                class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    </div>
                    <!-- Campo Hora -->
                    <div>
                        <label for="hora" class="block text-sm font-medium text-gray-700">Hora</label>
                        <input type="time" id="hora" name="hora" required
                                class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    </div>
                </div>
            </section>

            <!-- Sección 2: Información general -->
            <section class="border-b pb-8 border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">a) INFORMACIÓN GENERAL:</h2>
                <p class="text-gray-600 leading-relaxed text-justify mb-4">
                    La Medicina Ayurveda es una práctica de bienestar complementaria e integrativa enfocada en el equilibrio de la constitución (Doshas), la mejora del estilo de vida (Dinacharya) y la promoción de la salud.
                </p>
                <p class="text-gray-600 leading-relaxed text-justify mb-4">
                    Esto significa que puede coexistir y trabajar en sinergia con la medicina alopática (occidental), sin la intención de reemplazarla. En consecuencia, no ofrece garantía de curación ni constituye un tratamiento concluyente para ninguna condición médica específica.
                </p>
                <p class="text-gray-600 leading-relaxed text-justify mb-4">
                    Las recomendaciones dietéticas, de estilo de vida, y el uso de plantas o terapias corporales se basan en la tradición ayurvédica y en el estudio de la constitución individual (Prakriti y Vikruti).
                </p>
                <p class="text-gray-600 leading-relaxed text-justify mb-4">
                    La Profesional en Medicina Ayurveda es egresada de la India con el título de Médica Ayurveda (Vaidya - B.A.M.S.), el cual aún no se encuentra revalidado como título alopático en la República Argentina, su función se limita a la guía de bienestar y estilo de vida, razón por la cual se considera una terapia complementaria.
                </p>
                <p class="text-gray-600 leading-relaxed text-justify">
                    La Profesional en Medicina Ayurveda no realiza actos de la medicina alopática, tales como el diagnóstico, prescripción de fármacos o realización de cirugías.
                </p>
            </section>
            
            <!-- Sección 3: Objetivos -->
            <section class="border-b pb-8 border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">b) OBJETIVOS DE LA GUÍA AYURVÉDICA:</h2>
                <p class="text-gray-600 leading-relaxed text-justify">
                    A través de la alimentación, el uso de hierbas medicinales, ejercicio, meditación y técnicas de respiración (kriyas y pranayamas), el Ayurveda busca restablecer el equilibrio natural del cuerpo y fomentar un estilo de vida que prevenga enfermedades y promueva la longevidad.
                </p>
            </section>

            <!-- Sección 4: A tener en cuenta -->
            <section class="border-b pb-8 border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">c) A TENER EN CUENTA:</h2>
                <p class="text-gray-600 leading-relaxed text-justify mb-4">
                    Si bien las respuestas inusuales o molestias son verdaderamente muy poco frecuentes, y la vasta mayoría de las personas se siente muy bien con estas terapias, para garantizar que el uso de las plantas medicinales sea siempre beneficioso y seguro, recuerde las siguientes reglas fundamentales:
                </p>
                <ul class="list-disc list-inside space-y-3 text-gray-700 ml-4">
                    <li><strong>Respetar el tiempo de uso:</strong> Tomar las plantas sólo por el período indicado. Su uso prolongado sin supervisión puede alterar sus efectos.</li>
                    <li><strong>No exceder la dosis aconsejada:</strong> La cantidad recomendada es la efectiva y segura.</li>
                    <li><strong>Escuchar su cuerpo:</strong> Si siente alguna molestia o reacción inusual, suspender el uso inmediatamente.</li>
                </ul>
            </section>

            <!-- Sección 5: Al dar mi consentimiento -->
            <section class="border-b pb-8 border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">d) AL DAR MI CONSENTIMIENTO:</h2>
                <div class="space-y-4 text-gray-600 leading-relaxed text-justify">
                    <p>
                        <strong>1.</strong> Entiendo mi estado de salud y que la implementación de la Guía Ayurveda supone beneficios esperados para restablecer el equilibrio natural de mi cuerpo y mejorar mi estilo de vida a efectos de prevenir enfermedades y promover la longevidad. Se me explicó acabadamente acerca de los métodos y/o pautas sugeridas.
                    </p>
                    <p>
                        <strong>2.</strong> He brindado información veraz respecto de mi estado de salud actual y mi condición médica, diagnósticos previos (incluidos los de enfermedades crónicas, autoinmunes o cáncer), medicación alopática, suplementos y tratamientos paralelos que esté recibiendo antes y durante esta consulta. Me comprometo a brindar esta información toda vez que me sea solicitada, y a cumplir con las pautas que me sean indicadas y también a informar aquellas que no he de cumplir.
                    </p>
                    <p>
                        <strong>3.</strong> Entiendo que la Guía Ayurveda es de carácter complementario y no sustituye de modo alguno la atención médica proporcionada por la medicina convencional. Entiendo que resulta imprescindible seguir las indicaciones de mi médico de cabecera para el mantenimiento de mi bienestar integral, y que no suspenderé, abandonaré o alteraré ninguna medicación o tratamiento médico sin la indicación expresa de mi médico tratante. Asimismo informaré si mi médico me indica una modificación en mi tratamiento alopático que pueda interactuar con las recomendaciones ayurvédicas.
                    </p>
                    <p>
                        <strong>4.</strong> Asumo que en caso de experimentar cualquier reacción adversa, suspenderé de inmediato la aplicación de la Guía Ayurveda, y lo informaré a la mayor brevedad posible. La Profesional en Medicina Ayurveda no asumirá responsabilidad alguna por el uso inapropiado o indebido de las sugerencias ofrecidas.
                    </p>
                    <p>
                        <strong>5.</strong> Autorizo a la Profesional en Medicina Ayurveda a almacenar la información del historial de salud únicamente para fines de seguimiento terapéutico interno, y el Terapeuta se compromete a mantener la estricta confidencialidad de la información compartida por mí como consultante.
                    </p>
                    <p>
                        <strong>6.</strong> Asumo el compromiso de respetar la guía recibida y aplicarla sin hacer mal uso de ella.
                    </p>
                </div>
            </section>

            <!-- Sección 6: MUY IMPORTANTE -->
            <section class="border-b pb-8 border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">MUY IMPORTANTE:</h2>
                <p class="text-gray-600 leading-relaxed text-justify">
                    La utilización de la Guía Ayurveda, es libre y voluntaria, y usted tiene derecho a elegir lo que considere mejor para sus intereses, teniendo en cuenta la información recibida por parte del profesional. Si usted tuviera cualquier duda sobre el mismo, los riesgos o los resultados, no dude en preguntar las veces que considere necesario. Le explicaremos todo lo que usted desee saber. Si decidiera no aplicar la Guía, o suspender su utilización, puede hacerlo cuando lo desee y con total libertad, debiendo informarnos de tal decisión.
                </p>
            </section>
            
            <!-- Sección final con la casilla de verificación simulada -->
            <section class="border-b pb-8 border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Doy mi consentimiento para recibir el asesoramiento y la guía</h2>
                <div class="flex items-center">
                    <div id="consentimientoCheckbox" class="custom-checkbox">
                        <span class="checkmark">&#10003;</span>
                    </div>
                    <input type="hidden" id="consentimiento_estado" name="consentimiento_estado" value="No">
                </div>
            </section>
            
            <!-- Botón de envío -->
            <div class="flex justify-end">
                <button type="submit" id="submit-button"
                        class="px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                    Enviar
                </button>
            </div>
        </form>

        <!-- Contenedor para mostrar mensajes -->
        <div id="message-container" class="mt-8 hidden">
            <div id="message-box" class="p-4 rounded-md shadow-sm"></div>
        </div>

    </div>

    <!-- Script para manejar la lógica del formulario -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('consentimientoForm');
            const submitButton = document.getElementById('submit-button');
            const messageContainer = document.getElementById('message-container');
            const messageBox = document.getElementById('message-box');
            const customCheckbox = document.getElementById('consentimientoCheckbox');
            const consentimientoEstadoInput = document.getElementById('consentimiento_estado'); 

            let isChecked = false;

            customCheckbox.addEventListener('click', () => {
                isChecked = !isChecked;
                if (isChecked) {
                    customCheckbox.classList.add('checked');
                    consentimientoEstadoInput.value = 'Sí'; 
                } else {
                    customCheckbox.classList.remove('checked');
                    consentimientoEstadoInput.value = 'No'; 
                }
            });

            form.addEventListener('submit', async function(event) {
                event.preventDefault(); 
                
                if (!isChecked) {
                    messageBox.innerHTML = '<p class="text-red-800 font-medium">Por favor, marca la casilla de consentimiento para continuar.</p>';
                    messageBox.classList.remove('bg-blue-100', 'bg-green-100');
                    messageBox.classList.add('bg-red-100');
                    messageContainer.classList.remove('hidden');
                    return;
                }

                messageBox.innerHTML = '<p class="text-blue-800 font-medium">Enviando formulario...</p>';
                messageBox.classList.remove('bg-green-100', 'bg-red-100');
                messageBox.classList.add('bg-blue-100');
                messageContainer.classList.remove('hidden');
                submitButton.disabled = true;

                const flaskUrl = 'https://imuser.ddns.net/submit-form';
                
                const formInputs = document.querySelectorAll('#consentimientoForm input');
                formInputs.forEach(input => {
                    input.setAttribute('value', input.value); 
                    input.setAttribute('disabled', 'true');
                });
                
                if (isChecked) {
                    customCheckbox.classList.add('checked');
                }
                
                submitButton.style.display = 'none';
                messageContainer.style.display = 'none';

                const formContainer = document.getElementById('form-container');
                const formHtml = formContainer.outerHTML;

                const dniValue = document.getElementById('dni').value;
                const dniFilenamePart = dniValue.replace(/[^a-zA-Z0-9]/g, '').trim();
                const filename = `Consentimiento_DNI_${dniFilenamePart}.pdf`;

                const formData = {
                    nombre: document.getElementById('nombre').value,
                    dni: dniValue,
                    lugar: document.getElementById('lugar').value,
                    fecha: document.getElementById('fecha').value,
                    hora: document.getElementById('hora').value,
                    consentimiento: consentimientoEstadoInput.value, 
                    form_html: formHtml,
                    pdf_filename: filename 
                };

                try {
                    const response = await fetch(flaskUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData),
                    });

                    if (response.ok) {
                        messageBox.innerHTML = `<p class="text-green-800 font-medium">¡Gracias! El formulario ha sido enviado con éxito.</p>`;
                        messageBox.classList.remove('bg-blue-100', 'bg-red-100');
                        messageBox.classList.add('bg-green-100');
                        
                        form.reset(); 
                        isChecked = false;
                        customCheckbox.classList.remove('checked');
                        consentimientoEstadoInput.value = 'No';
                    } else {
                        const errorData = await response.json(); 
                        const errorMessage = errorData.message || `Error en el servidor: ${response.status} (${response.statusText})`;
                        messageBox.innerHTML = `<p class="text-red-800 font-medium">Error en el servidor: ${errorMessage}</p>`;
                        messageBox.classList.remove('bg-blue-100', 'bg-green-100');
                        messageBox.classList.add('bg-red-100');
                    }
                } catch (error) {
                    console.error('Error al enviar el formulario:', error);
                    messageBox.innerHTML = `<p class="text-red-800 font-medium">Ocurrió un error de conexión. Revisa si el servidor está funcionando.</p>`;
                    messageBox.classList.remove('bg-blue-100', 'bg-green-100');
                    messageBox.classList.add('bg-red-100');
                } finally {
                    submitButton.disabled = false;
                    submitButton.style.display = 'block';
                    messageContainer.style.display = 'block';

                    formInputs.forEach(input => {
                        input.removeAttribute('disabled');
                    });
                    
                    if (isChecked) {
                       customCheckbox.classList.add('checked');
                    } else {
                       customCheckbox.classList.remove('checked');
                    }
                }
            });
        });
    </script>
</body>
</html>
